<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>COT Dashboard - All Markets</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      min-height: 100vh; color: #e4e4e7; padding: 20px;
    }
    .container { max-width: 1600px; margin: 0 auto; }
    header { text-align: center; margin-bottom: 30px; }
    h1 { font-size: 2rem; font-weight: 700; margin-bottom: 8px; 
         background: linear-gradient(90deg, #60a5fa, #a78bfa); 
         -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .subtitle { color: #9ca3af; font-size: 0.9rem; }
    .report-date { background: #374151; padding: 8px 16px; border-radius: 8px; 
                   display: inline-block; margin-top: 10px; font-weight: 600; color: #fbbf24; }
    
    .controls { display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap; }
    .btn { padding: 12px 24px; border-radius: 8px; border: none; cursor: pointer; 
           font-weight: 600; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
    .btn-primary { background: #3b82f6; color: white; }
    .btn-primary:hover { background: #2563eb; }
    .btn-primary:disabled { background: #4b5563; cursor: not-allowed; }
    .btn-secondary { background: #374151; color: #e4e4e7; border: 1px solid #4b5563; }
    .btn-secondary:hover { background: #4b5563; }
    
    .status { text-align: center; padding: 12px; border-radius: 8px; margin-bottom: 20px; font-size: 0.9rem; }
    .status.loading { background: rgba(251, 191, 36, 0.1); color: #fbbf24; }
    .status.success { background: rgba(34, 197, 94, 0.1); color: #4ade80; }
    .status.error { background: rgba(239, 68, 68, 0.1); color: #f87171; }
    .status.hidden { display: none; }
    
    .section { margin-bottom: 30px; }
    .section-title { font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; 
                     color: #9ca3af; border-bottom: 1px solid #374151; padding-bottom: 8px; }
    
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 12px; }
    
    .card { background: rgba(55, 65, 81, 0.5); border-radius: 12px; padding: 14px;
            border: 1px solid #4b5563; transition: all 0.2s; }
    .card:hover { border-color: #6b7280; transform: translateY(-2px); }
    
    .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .pair-name { font-weight: 700; font-size: 1rem; }
    .sentiment { padding: 3px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 600; text-transform: uppercase; }
    .bullish { background: rgba(34, 197, 94, 0.2); color: #4ade80; }
    .bearish { background: rgba(239, 68, 68, 0.2); color: #f87171; }
    .neutral { background: rgba(156, 163, 175, 0.2); color: #9ca3af; }
    
    .value-box { background: rgba(0,0,0,0.2); border-radius: 8px; padding: 8px; margin-top: 8px; }
    .value-label { font-size: 0.65rem; color: #9ca3af; margin-bottom: 3px; text-transform: uppercase; }
    .value-number { font-size: 1rem; font-weight: 700; }
    .value-number.positive { color: #4ade80; }
    .value-number.negative { color: #f87171; }
    
    .bar-container { height: 5px; background: #4b5563; border-radius: 3px; overflow: hidden; margin-top: 5px; }
    .bar { height: 100%; border-radius: 3px; transition: width 0.3s; }
    .bar.positive { background: linear-gradient(90deg, #22c55e, #4ade80); }
    .bar.negative { background: linear-gradient(90deg, #f87171, #ef4444); }
    
    .footer { text-align: center; margin-top: 40px; padding-top: 20px; 
              border-top: 1px solid #374151; color: #6b7280; font-size: 0.8rem; }
    
    .tabs { display: flex; gap: 8px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
    .tab { padding: 8px 14px; border-radius: 8px; cursor: pointer; background: #374151; 
           border: 1px solid #4b5563; transition: all 0.2s; font-size: 0.85rem; }
    .tab:hover { background: #4b5563; }
    .tab.active { background: #3b82f6; border-color: #3b82f6; }
    
    .hidden { display: none; }
    
    .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid #4b5563;
               border-top-color: white; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .last-updated { font-size: 0.8rem; color: #6b7280; margin-top: 10px; }
    
    .info-box { background: rgba(59, 130, 246, 0.1); border: 1px solid #3b82f6; 
                border-radius: 8px; padding: 15px; margin-bottom: 20px; text-align: center; }
    .info-box p { color: #93c5fd; font-size: 0.85rem; }
    
    .nav-link { color: #60a5fa; text-decoration: none; margin-left: 15px; }
    .nav-link:hover { text-decoration: underline; }

    .progress-container { margin: 20px 0; }
    .progress-bar { height: 6px; background: #374151; border-radius: 3px; overflow: hidden; }
    .progress-fill { height: 100%; background: #3b82f6; transition: width 0.3s; }
    .progress-text { text-align: center; margin-top: 8px; font-size: 0.8rem; color: #9ca3af; }
    
    @media (max-width: 768px) {
      .grid { grid-template-columns: 1fr 1fr; }
      h1 { font-size: 1.5rem; }
      .tabs { gap: 5px; }
      .tab { padding: 6px 10px; font-size: 0.75rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìä COT Dashboard - All Markets</h1>
      <p class="subtitle">CFTC Commitment of Traders - Non-Commercial Net Position Changes (Futures Only)</p>
      <div class="report-date" id="report-date">Loading...</div>
      <div class="last-updated" id="last-updated"></div>
    </header>
    
    <div class="info-box">
      <p>üÜì <strong>No API key required!</strong> Data fetched directly from official CFTC Public Reporting API
        <a href="journal.html" class="nav-link">üìù Open Trading Journal</a>
      </p>
    </div>
    
    <div class="controls">
      <button class="btn btn-primary" id="fetch-btn" onclick="fetchAllData()">
        <span id="fetch-btn-text">üîÑ Fetch Latest Data</span>
      </button>
      <button class="btn btn-secondary" onclick="clearCache()">üóëÔ∏è Clear Cache</button>
    </div>
    
    <div id="status" class="status hidden"></div>
    
    <div id="progress-container" class="progress-container hidden">
      <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
      <div class="progress-text" id="progress-text">Loading...</div>
    </div>
    
    <div class="tabs">
      <div class="tab active" onclick="showSection('all', this)">All</div>
      <div class="tab" onclick="showSection('currencies', this)">üí± Currencies</div>
      <div class="tab" onclick="showSection('crosses', this)">üîÑ Crosses</div>
      <div class="tab" onclick="showSection('indices', this)">üìà Indices</div>
      <div class="tab" onclick="showSection('energy', this)">üõ¢Ô∏è Energy</div>
      <div class="tab" onclick="showSection('metals', this)">ü•á Metals</div>
      <div class="tab" onclick="showSection('grains', this)">üåæ Grains</div>
      <div class="tab" onclick="showSection('softs', this)">‚òï Softs</div>
      <div class="tab" onclick="showSection('meats', this)">ü•© Meats</div>
      <div class="tab" onclick="showSection('crypto', this)">‚Çø Crypto</div>
    </div>
    
    <div id="currencies" class="section">
      <div class="section-title">üí± Currencies</div>
      <div class="grid" id="currencies-grid"></div>
    </div>
    
    <div id="crosses" class="section">
      <div class="section-title">üîÑ Cross Pairs (Calculated from Currency Positioning)</div>
      <div class="grid" id="crosses-grid"></div>
    </div>
    
    <div id="indices" class="section">
      <div class="section-title">üìà Stock Indices</div>
      <div class="grid" id="indices-grid"></div>
    </div>
    
    <div id="energy" class="section">
      <div class="section-title">üõ¢Ô∏è Energy</div>
      <div class="grid" id="energy-grid"></div>
    </div>
    
    <div id="metals" class="section">
      <div class="section-title">ü•á Metals</div>
      <div class="grid" id="metals-grid"></div>
    </div>
    
    <div id="grains" class="section">
      <div class="section-title">üåæ Grains & Oilseeds</div>
      <div class="grid" id="grains-grid"></div>
    </div>
    
    <div id="softs" class="section">
      <div class="section-title">‚òï Softs (Coffee, Sugar, Cotton, etc.)</div>
      <div class="grid" id="softs-grid"></div>
    </div>
    
    <div id="meats" class="section">
      <div class="section-title">ü•© Meats</div>
      <div class="grid" id="meats-grid"></div>
    </div>
    
    <div id="crypto" class="section">
      <div class="section-title">‚Çø Cryptocurrency</div>
      <div class="grid" id="crypto-grid"></div>
    </div>
    
    <footer class="footer">
      <p>Data Source: <a href="https://publicreporting.cftc.gov" target="_blank" style="color: #60a5fa;">CFTC Public Reporting API</a> - Futures Only</p>
      <p style="margin-top: 5px;">Net Change = Non-Commercial Long Change ‚àí Short Change | New data every Friday ~3:30 PM ET</p>
    </footer>
  </div>

  <script>
    const API_FUTURES_ONLY = 'https://publicreporting.cftc.gov/resource/6dca-aqww.json';
    
    // ALL MARKETS CONTRACT MAPPINGS
    const CONTRACT_MAP = {
      // === CURRENCIES ===
      DXY: { search: 'U.S. DOLLAR INDEX', exchange: 'ICE FUTURES U.S.', category: 'currencies', name: 'US Dollar Index' },
      EUR: { search: 'EURO FX', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'Euro' },
      GBP: { search: 'BRITISH POUND', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'British Pound' },
      JPY: { search: 'JAPANESE YEN', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'Japanese Yen' },
      AUD: { search: 'AUSTRALIAN DOLLAR', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'Australian Dollar' },
      CAD: { search: 'CANADIAN DOLLAR', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'Canadian Dollar' },
      NZD: { search: 'NZ DOLLAR', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'New Zealand Dollar' },
      CHF: { search: 'SWISS FRANC', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'Swiss Franc' },
      MXN: { search: 'MEXICAN PESO', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'Mexican Peso' },
      BRL: { search: 'BRAZILIAN REAL', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'Brazilian Real' },
      ZAR: { search: 'SO AFRICAN RAND', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'currencies', name: 'South African Rand' },
      
      // === STOCK INDICES ===
      SP500: { search: 'E-MINI S&P 500', exchange: 'CHICAGO MERCANTILE EXCHANGE', exactMatch: 'E-MINI S&P 500 - CHICAGO MERCANTILE EXCHANGE', category: 'indices', name: 'S&P 500' },
      NASDAQ: { search: 'NASDAQ MINI', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'indices', name: 'Nasdaq 100' },
      DOW: { search: 'DJIA', exchange: 'CHICAGO BOARD OF TRADE', category: 'indices', name: 'Dow Jones' },
      RUSSELL: { search: 'RUSSELL E-MINI', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'indices', name: 'Russell 2000' },
      NIKKEI: { search: 'NIKKEI STOCK', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'indices', name: 'Nikkei 225' },
      VIX: { search: 'VIX FUTURES', exchange: 'CBOE FUTURES EXCHANGE', category: 'indices', name: 'VIX' },
      
      // === ENERGY ===
      WTI: { search: 'CRUDE OIL, LIGHT SWEET', exchange: 'NEW YORK MERCANTILE EXCHANGE', category: 'energy', name: 'WTI Crude Oil' },
      BRENT: { search: 'BRENT CRUDE', exchange: 'NEW YORK MERCANTILE EXCHANGE', category: 'energy', name: 'Brent Crude' },
      NATGAS: { search: 'NATURAL GAS', exchange: 'NEW YORK MERCANTILE EXCHANGE', category: 'energy', name: 'Natural Gas' },
      RBOB: { search: 'RBOB GASOLINE', exchange: 'NEW YORK MERCANTILE EXCHANGE', category: 'energy', name: 'Gasoline (RBOB)' },
      HEATING: { search: 'NO. 2 HEATING OIL', exchange: 'NEW YORK MERCANTILE EXCHANGE', category: 'energy', name: 'Heating Oil' },
      
      // === METALS ===
      GOLD: { search: 'GOLD', exchange: 'COMMODITY EXCHANGE INC', exclude: 'MICRO', category: 'metals', name: 'Gold' },
      SILVER: { search: 'SILVER', exchange: 'COMMODITY EXCHANGE INC', exclude: 'MICRO', category: 'metals', name: 'Silver' },
      COPPER: { search: 'COPPER', exchange: 'COMMODITY EXCHANGE INC', category: 'metals', name: 'Copper' },
      PLATINUM: { search: 'PLATINUM', exchange: 'NEW YORK MERCANTILE EXCHANGE', category: 'metals', name: 'Platinum' },
      PALLADIUM: { search: 'PALLADIUM', exchange: 'NEW YORK MERCANTILE EXCHANGE', category: 'metals', name: 'Palladium' },
      
      // === GRAINS & OILSEEDS ===
      CORN: { search: 'CORN', exchange: 'CHICAGO BOARD OF TRADE', exclude: 'MICRO', category: 'grains', name: 'Corn' },
      WHEAT: { search: 'WHEAT-SRW', exchange: 'CHICAGO BOARD OF TRADE', category: 'grains', name: 'Wheat (SRW)' },
      WHEATK: { search: 'WHEAT-HRW', exchange: 'CHICAGO BOARD OF TRADE', category: 'grains', name: 'Wheat (HRW)' },
      SOYBEANS: { search: 'SOYBEANS', exchange: 'CHICAGO BOARD OF TRADE', exclude: 'MICRO', category: 'grains', name: 'Soybeans' },
      SOYOIL: { search: 'SOYBEAN OIL', exchange: 'CHICAGO BOARD OF TRADE', category: 'grains', name: 'Soybean Oil' },
      SOYMEAL: { search: 'SOYBEAN MEAL', exchange: 'CHICAGO BOARD OF TRADE', category: 'grains', name: 'Soybean Meal' },
      OATS: { search: 'OATS', exchange: 'CHICAGO BOARD OF TRADE', category: 'grains', name: 'Oats' },
      RICE: { search: 'ROUGH RICE', exchange: 'CHICAGO BOARD OF TRADE', category: 'grains', name: 'Rough Rice' },
      
      // === SOFTS ===
      COFFEE: { search: 'COFFEE C', exchange: 'ICE FUTURES U.S.', category: 'softs', name: 'Coffee' },
      SUGAR: { search: 'SUGAR NO. 11', exchange: 'ICE FUTURES U.S.', category: 'softs', name: 'Sugar #11' },
      COTTON: { search: 'COTTON NO. 2', exchange: 'ICE FUTURES U.S.', category: 'softs', name: 'Cotton' },
      COCOA: { search: 'COCOA', exchange: 'ICE FUTURES U.S.', category: 'softs', name: 'Cocoa' },
      OJ: { search: 'FRZN CONCENTRATED ORANGE JUICE', exchange: 'ICE FUTURES U.S.', category: 'softs', name: 'Orange Juice' },
      LUMBER: { search: 'LUMBER', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'softs', name: 'Lumber' },
      
      // === MEATS ===
      CATTLE: { search: 'LIVE CATTLE', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'meats', name: 'Live Cattle' },
      FEEDER: { search: 'FEEDER CATTLE', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'meats', name: 'Feeder Cattle' },
      HOGS: { search: 'LEAN HOGS', exchange: 'CHICAGO MERCANTILE EXCHANGE', category: 'meats', name: 'Lean Hogs' },
      
      // === CRYPTO ===
      BTC: { search: 'BITCOIN', exchange: 'CHICAGO MERCANTILE EXCHANGE', exclude: 'MICRO', category: 'crypto', name: 'Bitcoin' },
      ETH: { search: 'ETHER', exchange: 'CHICAGO MERCANTILE EXCHANGE', exclude: 'MICRO', category: 'crypto', name: 'Ethereum' },
    };

    // Initialize data storage
    let futuresData = {};
    Object.keys(CONTRACT_MAP).forEach(id => futuresData[id] = 0);
    
    let reportDate = '';

    // Cross pairs (calculated from base currencies)
    const crossPairs = [
      { pair: 'EUR/GBP', base: 'EUR', quote: 'GBP' },
      { pair: 'EUR/JPY', base: 'EUR', quote: 'JPY' },
      { pair: 'EUR/AUD', base: 'EUR', quote: 'AUD' },
      { pair: 'EUR/CAD', base: 'EUR', quote: 'CAD' },
      { pair: 'EUR/NZD', base: 'EUR', quote: 'NZD' },
      { pair: 'EUR/CHF', base: 'EUR', quote: 'CHF' },
      { pair: 'GBP/JPY', base: 'GBP', quote: 'JPY' },
      { pair: 'GBP/AUD', base: 'GBP', quote: 'AUD' },
      { pair: 'GBP/CAD', base: 'GBP', quote: 'CAD' },
      { pair: 'GBP/NZD', base: 'GBP', quote: 'NZD' },
      { pair: 'GBP/CHF', base: 'GBP', quote: 'CHF' },
      { pair: 'AUD/JPY', base: 'AUD', quote: 'JPY' },
      { pair: 'AUD/CAD', base: 'AUD', quote: 'CAD' },
      { pair: 'AUD/NZD', base: 'AUD', quote: 'NZD' },
      { pair: 'AUD/CHF', base: 'AUD', quote: 'CHF' },
      { pair: 'NZD/JPY', base: 'NZD', quote: 'JPY' },
      { pair: 'NZD/CAD', base: 'NZD', quote: 'CAD' },
      { pair: 'NZD/CHF', base: 'NZD', quote: 'CHF' },
      { pair: 'CAD/JPY', base: 'CAD', quote: 'JPY' },
      { pair: 'CAD/CHF', base: 'CAD', quote: 'CHF' },
      { pair: 'CHF/JPY', base: 'CHF', quote: 'JPY' },
    ];

    function loadSavedData() {
      const saved = localStorage.getItem('cot-all-markets-v1');
      if (saved) {
        const parsed = JSON.parse(saved);
        futuresData = { ...futuresData, ...parsed.futuresData };
        reportDate = parsed.reportDate || reportDate;
        if (parsed.fetchedAt) {
          document.getElementById('last-updated').textContent = 
            `Last fetched: ${new Date(parsed.fetchedAt).toLocaleString()}`;
        }
      }
      updateUI();
    }

    function showStatus(message, type) {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status ${type}`;
    }

    function updateProgress(current, total, message) {
      const container = document.getElementById('progress-container');
      const fill = document.getElementById('progress-fill');
      const text = document.getElementById('progress-text');
      container.classList.remove('hidden');
      fill.style.width = `${(current / total) * 100}%`;
      text.textContent = message;
    }

    function hideProgress() {
      document.getElementById('progress-container').classList.add('hidden');
    }

    async function fetchContractData(apiUrl, id, config) {
      let whereClause;
      if (config.exactMatch) {
        whereClause = `market_and_exchange_names = '${config.exactMatch}'`;
      } else {
        whereClause = `market_and_exchange_names like '%${config.search}%' AND market_and_exchange_names like '%${config.exchange}%'`;
      }
      
      const query = new URLSearchParams({
        '$where': whereClause,
        '$order': 'report_date_as_yyyy_mm_dd DESC',
        '$limit': '5'
      });
      
      const url = `${apiUrl}?${query}`;
      const response = await fetch(url);
      
      if (!response.ok) throw new Error(`HTTP ${response.status}`);
      
      let data = await response.json();
      
      if (config.exclude) {
        data = data.filter(d => !d.market_and_exchange_names.includes(config.exclude));
      }
      
      if (data.length < 2) {
        console.warn(`${id}: Not enough data points`);
        return null;
      }
      
      const latest = data[0];
      const previous = data[1];
      
      let longChange = parseInt(latest.change_in_noncomm_long_all || 0);
      let shortChange = parseInt(latest.change_in_noncomm_short_all || 0);
      
      if (longChange === 0 && shortChange === 0) {
        const currentLong = parseInt(latest.noncomm_positions_long_all || 0);
        const currentShort = parseInt(latest.noncomm_positions_short_all || 0);
        const prevLong = parseInt(previous.noncomm_positions_long_all || 0);
        const prevShort = parseInt(previous.noncomm_positions_short_all || 0);
        
        longChange = currentLong - prevLong;
        shortChange = currentShort - prevShort;
      }
      
      return {
        netChange: longChange - shortChange,
        reportDate: latest.report_date_as_yyyy_mm_dd
      };
    }

    async function fetchAllData() {
      const btn = document.getElementById('fetch-btn');
      const btnText = document.getElementById('fetch-btn-text');
      btn.disabled = true;
      btnText.innerHTML = '<span class="spinner"></span> Fetching...';
      showStatus('Fetching data from CFTC API...', 'loading');

      let latestDate = '';
      let successCount = 0;
      let errorCount = 0;
      const entries = Object.entries(CONTRACT_MAP);
      const total = entries.length;

      try {
        for (let i = 0; i < entries.length; i++) {
          const [id, config] = entries[i];
          updateProgress(i + 1, total, `Fetching ${config.name}... (${i + 1}/${total})`);
          
          try {
            const result = await fetchContractData(API_FUTURES_ONLY, id, config);
            if (result) {
              futuresData[id] = result.netChange;
              if (result.reportDate > latestDate) latestDate = result.reportDate;
              successCount++;
              console.log(`‚úÖ ${id}: ${result.netChange}`);
            }
          } catch (err) {
            console.error(`‚ùå ${id}:`, err);
            errorCount++;
          }
          
          // Small delay to avoid rate limiting
          await new Promise(r => setTimeout(r, 50));
        }

        reportDate = latestDate || reportDate;
        
        localStorage.setItem('cot-all-markets-v1', JSON.stringify({
          futuresData, reportDate,
          fetchedAt: new Date().toISOString()
        }));

        document.getElementById('last-updated').textContent = 
          `Last fetched: ${new Date().toLocaleString()}`;

        hideProgress();
        updateUI();
        showStatus(`‚úÖ Updated ${successCount}/${total} contracts! (${errorCount} errors)`, 'success');

      } catch (error) {
        console.error('Fetch error:', error);
        hideProgress();
        showStatus(`Error: ${error.message}`, 'error');
      } finally {
        btn.disabled = false;
        btnText.textContent = 'üîÑ Fetch Latest Data';
      }
    }

    function clearCache() {
      localStorage.removeItem('cot-all-markets-v1');
      location.reload();
    }

    function getSentimentLabel(value) {
      if (value > 5000) return { label: 'Bullish', class: 'bullish' };
      if (value < -5000) return { label: 'Bearish', class: 'bearish' };
      return { label: 'Neutral', class: 'neutral' };
    }

    function formatNumber(num) {
      return new Intl.NumberFormat('en-US', { signDisplay: 'always' }).format(num);
    }

    function createCard(id) {
      const config = CONTRACT_MAP[id];
      const value = futuresData[id] || 0;
      const sentiment = getSentimentLabel(value);
      const maxVal = 50000;
      const barWidth = Math.min(Math.abs(value) / maxVal * 100, 100);
      
      return `
        <div class="card">
          <div class="card-header">
            <span class="pair-name">${config.name}</span>
            <span class="sentiment ${sentiment.class}">${sentiment.label}</span>
          </div>
          <div class="value-box">
            <div class="value-label">üìä Net Change</div>
            <div class="value-number ${value >= 0 ? 'positive' : 'negative'}">${formatNumber(value)}</div>
            <div class="bar-container">
              <div class="bar ${value >= 0 ? 'positive' : 'negative'}" style="width: ${barWidth}%"></div>
            </div>
          </div>
        </div>
      `;
    }

    function calculateCrossValue(cross) {
      const baseVal = futuresData[cross.base] || 0;
      const quoteVal = futuresData[cross.quote] || 0;
      return baseVal - quoteVal;
    }

    function createCrossCard(cross) {
      const value = calculateCrossValue(cross);
      const sentiment = getSentimentLabel(value);
      const maxVal = 50000;
      const barWidth = Math.min(Math.abs(value) / maxVal * 100, 100);
      
      return `
        <div class="card">
          <div class="card-header">
            <span class="pair-name">${cross.pair}</span>
            <span class="sentiment ${sentiment.class}">${sentiment.label}</span>
          </div>
          <div class="value-box">
            <div class="value-label">üìä Net Change</div>
            <div class="value-number ${value >= 0 ? 'positive' : 'negative'}">${formatNumber(value)}</div>
            <div class="bar-container">
              <div class="bar ${value >= 0 ? 'positive' : 'negative'}" style="width: ${barWidth}%"></div>
            </div>
          </div>
        </div>
      `;
    }

    function getContractsByCategory(category) {
      return Object.entries(CONTRACT_MAP)
        .filter(([id, config]) => config.category === category)
        .map(([id]) => id)
        .sort((a, b) => (futuresData[b] || 0) - (futuresData[a] || 0)); // Sort by value
    }

    function updateUI() {
      document.getElementById('report-date').textContent = `Report Date: ${reportDate || 'Not loaded'}`;
      
      const categories = ['currencies', 'indices', 'energy', 'metals', 'grains', 'softs', 'meats', 'crypto'];
      
      categories.forEach(category => {
        const grid = document.getElementById(`${category}-grid`);
        if (grid) {
          const contracts = getContractsByCategory(category);
          grid.innerHTML = contracts.map(createCard).join('');
        }
      });

      // Update crosses grid (sorted by value)
      const crossesGrid = document.getElementById('crosses-grid');
      if (crossesGrid) {
        const sortedCrosses = [...crossPairs].sort((a, b) => calculateCrossValue(b) - calculateCrossValue(a));
        crossesGrid.innerHTML = sortedCrosses.map(createCrossCard).join('');
      }
    }

    function showSection(section, element) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      element.classList.add('active');
      
      const sections = ['currencies', 'crosses', 'indices', 'energy', 'metals', 'grains', 'softs', 'meats', 'crypto'];
      sections.forEach(s => {
        document.getElementById(s).classList.toggle('hidden', section !== 'all' && section !== s);
      });
    }

    // Initialize
    loadSavedData();
  </script>
</body>
</html>
